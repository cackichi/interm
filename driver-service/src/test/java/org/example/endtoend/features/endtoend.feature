# language: ru
Функция: Управление водителями и автомобилями
  Проверка работы API для управления водителями и их автомобилями

  Сценарий: Успешное создание нового водителя
    Дано отправлен POST запрос на "/api/v1/drivers" с телом:
      """
      {
        "id": "driver1",
        "name": "Иван Иванов",
        "experience": 5,
        "phone": "+79991234567",
        "email": "ivan@example.com",
        "cars": []
      }
      """
    Тогда статус ответа должен быть 201
    И водитель сохранен в базе данных
    И событие "driver-create-event-topic" отправлено в Kafka

  Сценарий: Успешное обновление водителя
    Дано существует водитель с ID "driver1"
    Когда отправлен PATCH запрос на "/api/v1/drivers/driver1" с телом:
      """
      {
        "name": "Петр Петров",
        "experience": 10,
        "phone": "+79997654321",
        "email": "petr@example.com",
        "cars": []
      }
      """
    Тогда статус ответа должен быть 200
    И данные водителя обновлены в базе данных

  Сценарий: Успешное удаление водителя
    Дано существует водитель с ID "driver1"
    Когда отправлен DELETE запрос на "/api/v1/drivers/driver1"
    Тогда статус ответа должен быть 204
    И водитель помечен как удаленный в базе данных
    И событие "driver-soft-delete-event-topic" отправлено в Kafka

  Сценарий: Успешное создание автомобиля для водителя
    Дано существует водитель с ID "driver1"
    Когда отправлен POST запрос на "/api/v1/drivers/driver1/car" с телом запроса:
      """
      {
        "number": "A123BC",
        "brand": "Toyota",
        "color": "Black"
      }
      """
    Тогда статус ответа должен быть 201
    И автомобиль сохранен в базе данных

  Сценарий: Успешное обновление автомобиля
    Дано существует водитель с ID "driver1" и автомобиль с номером "A123BC"
    Когда отправлен PATCH запрос на "/api/v1/drivers/driver1/car" с телом:
      """
      {
        "number": "A123BC",
        "brand": "Honda",
        "color": "White"
      }
      """
    Тогда статус ответа должен быть 204
    И данные автомобиля обновлены в базе данных

  Сценарий: Успешное удаление автомобиля
    Дано существует водитель с ID "driver1" и автомобиль с номером "A123BC"
    Когда отправлен DELETE запрос на "/api/v1/drivers/driver1/car/A123BC"
    Тогда статус ответа должен быть 204
    И автомобиль удален из базы данных

  Сценарий: Успешное получение списка водителей с пагинацией
    Дано в системе существует 15 водителей
    Когда отправлен GET запрос на "/api/v1/drivers?page=1&size=5"
    Тогда статус ответа должен быть 200
    И в ответе содержится 5 водителей
    И поле "totalElements" равно 15
    И поле "totalPages" равно 3

  Сценарий: Успешное получение списка автомобилей водителя с пагинацией
    Дано существует водитель с ID "driver1" и 10 автомобилей
    Когда отправлен GET запрос на "/api/v1/drivers/driver1/cars?page=0&size=5"
    Тогда статус ответа должен быть 200
    И в ответе содержится 5 автомобилей
    И поле "totalElements" для машин равно 10
    И поле "totalPages" для машин равно 2